{% extends "base.html" %}

{% block content %}
<div class="dashboard">
    <div class="header">
        <h1>–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</h1>
        <div class="header-actions">
            <a href="{{ url_for('add_workout') }}" class="btn-primary">‚ûï –î–æ–±–∞–≤–∏—Ç—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É</a>
            <a href="{{ url_for('add_goal') }}" class="btn-secondary">üéØ –î–æ–±–∞–≤–∏—Ç—å —Ü–µ–ª—å</a>
        </div>
    </div>

    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
    <div class="stats-grid">
        <div class="stat-card">
            <h3>–¢—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ –∑–∞ –Ω–µ–¥–µ–ª—é</h3>
            <div class="stat-number">{{ week_workouts_count }}</div>
        </div>
        <div class="stat-card">
            <h3>–í—Å–µ–≥–æ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫</h3>
            <div class="stat-number">{{ workouts|length }}</div>
        </div>
        <div class="stat-card">
            <h3>–ê–∫—Ç–∏–≤–Ω—ã—Ö —Ü–µ–ª–µ–π</h3>
            <div class="stat-number">{{ goals|length }}</div>
        </div>
    </div>

    <!-- –ë–ª–æ–∫ —Ü–µ–ª–µ–π -->
    <div class="goals-section">
        <h2>–ú–æ–∏ —Ü–µ–ª–∏</h2>
        {% if goals %}
            <div class="goals-grid">
                {% for goal in goals %}
                <div class="goal-card {% if goal.is_completed %}completed{% endif %}">
                    <!-- –ö–Ω–æ–ø–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è - –í–°–ï–ì–î–ê –í –ü–†–ê–í–û–ú –í–ï–†–•–ù–ï–ú –£–ì–õ–£ -->
                    <a href="{{ url_for('delete_goal', goal_id=goal.id) }}" class="delete-goal-btn" onclick="return confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç—É —Ü–µ–ª—å?')">√ó</a>
                    
                    <div class="goal-header">
                        <h4>{{ goal.exercise_type }}</h4>
                        <div class="goal-header-info">
                            <span class="goal-deadline">–¥–æ {{ goal.target_date.strftime('%d.%m.%Y') }}</span>
                        </div>
                    </div>
                    <div class="goal-details">
                        <div class="goal-target">
                            <strong>–¶–µ–ª—å:</strong> {{ goal.target_weight }}–∫–≥ √ó {{ goal.target_reps }}–ø–æ–≤—Ç. √ó {{ goal.target_sets }}–ø–æ–¥—Ö.
                        </div>
                        {% if goal.current_weight and goal.current_weight > 0 %}
                        <div class="goal-current">
                            <strong>–¢–µ–∫—É—â–∏–π:</strong> {{ goal.current_weight }}–∫–≥ √ó {{ goal.current_reps }}–ø–æ–≤—Ç. √ó {{ goal.current_sets }}–ø–æ–¥—Ö.
                        </div>
                        {% endif %}
                    </div>
                    <div class="goal-progress">
                        <div class="progress-text">
                            –ü—Ä–æ–≥—Ä–µ—Å—Å: {{ "%.1f"|format(goal.progress_percentage) }}%
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: {{ goal.progress_percentage }}%;"></div>
                        </div>
                    </div>
                    <div class="goal-actions">
                        <a href="{{ url_for('update_progress', goal_id=goal.id) }}" class="btn-small">
                            üîÑ –û–±–Ω–æ–≤–∏—Ç—å
                        </a>
                    </div>
                    {% if goal.is_completed %}
                    <div class="goal-completed">üéâ –¶–µ–ª—å –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–∞!</div>
                    {% endif %}
                </div>
                {% endfor %}
            </div>
        {% else %}
            <p class="no-data">–¶–µ–ª–µ–π –ø–æ–∫–∞ –Ω–µ—Ç. <a href="{{ url_for('add_goal') }}">–î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—É—é —Ü–µ–ª—å!</a></p>
        {% endif %}
    </div>

    <!-- –ü–æ—Å–ª–µ–¥–Ω–∏–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ -->
    <div class="workout-list">
        <h2>–ü–æ—Å–ª–µ–¥–Ω–∏–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏</h2>
        {% if workouts %}
            {% for workout in workouts %}
            <div class="workout-item">
                <div class="workout-date">{{ workout.date.strftime('%d.%m.%Y') }}</div>
                <div class="workout-details">
                    <span class="exercise">{{ workout.exercise_type }}</span>
                    <span class="weight">{{ workout.weight }} –∫–≥</span>
                    <span class="reps">{{ workout.reps }} –ø–æ–≤—Ç.</span>
                    <span class="sets">{{ workout.sets }} –ø–æ–¥—Ö.</span>
                </div>
            </div>
            {% endfor %}
        {% else %}
            <p class="no-data">–¢—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ –ø–æ–∫–∞ –Ω–µ—Ç. <a href="{{ url_for('add_workout') }}">–î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—É—é —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É!</a></p>
        {% endif %}
    </div>

    <!-- –ì—Ä–∞—Ñ–∏–∫ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ -->
    <div class="charts-section">
        <h2>–ü—Ä–æ–≥—Ä–µ—Å—Å –ø–æ –≤–µ—Å—É</h2>
        <div class="chart-container">
            <canvas id="progressChart"></canvas>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    const progressData = {{ progress_data | safe }};
    const ctx = document.getElementById('progressChart').getContext('2d');
    
    const datasets = [];
    const colors = ['#333', '#666', '#999', '#ccc', '#555', '#777'];
    
    let colorIndex = 0;
    for (const [exercise, data] of Object.entries(progressData)) {
        if (data.dates.length > 0) {
            datasets.push({
                label: exercise,
                data: data.weights,
                borderColor: colors[colorIndex % colors.length],
                backgroundColor: colors[colorIndex % colors.length] + '20',
                tension: 0.1,
                fill: false
            });
            colorIndex++;
        }
    }
    
    if (datasets.length > 0) {
        new Chart(ctx, {
            type: 'line',
            data: {
                labels: progressData[Object.keys(progressData)[0]]?.dates || [],
                datasets: datasets
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: '–í–µ—Å (–∫–≥)'
                        }
                    },
                    x: {
                        title: {
                            display: true,
                            text: '–î–∞—Ç–∞'
                        }
                    }
                }
            }
        });
    } else {
        document.querySelector('.chart-container').innerHTML = '<p class="no-data">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –≥—Ä–∞—Ñ–∏–∫–∞</p>';
    }
});
</script>
{% endblock %}
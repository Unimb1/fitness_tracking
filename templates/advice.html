<!-- templates/advice.html -->
{% extends "base.html" %}

{% block content %}
<div class="advice-page">
    <div class="header">
        <h2>–°–æ–≤–µ—Ç—ã –∏ –ê–Ω–∞–ª–∏—Ç–∏–∫–∞</h2>
        <p>–ù–∞—É—á–Ω–æ –æ–±–æ—Å–Ω–æ–≤–∞–Ω–Ω—ã–µ —Ä–∞—Å—á–µ—Ç—ã –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –≤–∞—à–µ–≥–æ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞</p>
    </div>

    <div class="advice-grid">
        <!-- –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –ø—Ä–æ–≥—Ä–µ—Å—Å–∏–∏ -->
        <div class="advice-card">
            <h3>üéØ –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –ø—Ä–æ–≥—Ä–µ—Å—Å–∏–∏</h3>
            <p>–†–∞—Å—Å—á–∏—Ç–∞–π—Ç–µ, –∑–∞ —Å–∫–æ–ª—å–∫–æ –≤—Ä–µ–º–µ–Ω–∏ –¥–æ—Å—Ç–∏–≥–Ω–µ—Ç–µ —Ü–µ–ª–µ–≤–æ–≥–æ –≤–µ—Å–∞</p>
            
            <form id="progression-form" class="calculator-form">
                <div class="form-group">
                    <label for="progression-exercise">–£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ:</label>
                    <select id="progression-exercise" name="exercise_type" required>
                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ</option>
                        <option value="–ñ–∏–º –ª–µ–∂–∞">–ñ–∏–º –ª–µ–∂–∞</option>
                        <option value="–°–≤–µ–¥–µ–Ω–∏–µ —Ä—É–∫ –≤ –∫—Ä–æ—Å—Å–æ–≤–µ—Ä–µ –Ω–∞ –≥—Ä—É–¥—å">–°–≤–µ–¥–µ–Ω–∏–µ —Ä—É–∫ –≤ –∫—Ä–æ—Å—Å–æ–≤–µ—Ä–µ –Ω–∞ –≥—Ä—É–¥—å</option>
                        <option value="–†–∞–∑–≥–∏–±–∞–Ω–∏—è –Ω–∞ —Ç—Ä–∏—Ü–µ–ø—Å —Å –∫–∞–Ω–∞—Ç–Ω–æ–π —Ä—É–∫–æ—è—Ç—å—é –≤ –∫—Ä–æ—Å—Å–æ–≤–µ—Ä–µ">–†–∞–∑–≥–∏–±–∞–Ω–∏—è –Ω–∞ —Ç—Ä–∏—Ü–µ–ø—Å —Å –∫–∞–Ω–∞—Ç–Ω–æ–π —Ä—É–∫–æ—è—Ç—å—é –≤ –∫—Ä–æ—Å—Å–æ–≤–µ—Ä–µ</option>
                        <option value="–°–≥–∏–±–∞–Ω–∏—è –Ω–∞ –±–∏—Ü–µ–ø—Å –≤ –†–¢">–°–≥–∏–±–∞–Ω–∏—è –Ω–∞ –±–∏—Ü–µ–ø—Å –≤ –†–¢</option>
                        <option value="–ü–æ–¥—ä–µ–º –Ω–∞ –±–∏—Ü–µ–ø—Å —à—Ç–∞–Ω–≥–∏ –æ–±—Ä–∞—Ç–Ω—ã–º —Ö–≤–∞—Ç–æ–º">–ü–æ–¥—ä–µ–º –Ω–∞ –±–∏—Ü–µ–ø—Å —à—Ç–∞–Ω–≥–∏ –æ–±—Ä–∞—Ç–Ω—ã–º —Ö–≤–∞—Ç–æ–º</option>
                        <option value="–Ø–≥–æ–¥–∏—á–Ω—ã–π –º–æ—Å—Ç –≤ –†–¢">–Ø–≥–æ–¥–∏—á–Ω—ã–π –º–æ—Å—Ç –≤ –†–¢</option>
                        <option value="–†–∞–∑–≥–∏–±–∞–Ω–∏–µ –≥–æ–ª–µ–Ω–∏ –≤ –ë–¢">–†–∞–∑–≥–∏–±–∞–Ω–∏–µ –≥–æ–ª–µ–Ω–∏ –≤ –ë–¢</option>
                        <option value="–°–≥–∏–±–∞–Ω–∏–µ –≥–æ–ª–µ–Ω–∏ –≤ –ë–¢">–°–≥–∏–±–∞–Ω–∏–µ –≥–æ–ª–µ–Ω–∏ –≤ –ë–¢</option>
                        <option value="–ò–∫—Ä–æ–Ω–æ–∂–Ω—ã–µ –≤ –¢">–ò–∫—Ä–æ–Ω–æ–∂–Ω—ã–µ –≤ –¢</option>
                        <option value="–í—Ä–∞—â–µ–Ω–∏—è –≥–∞–Ω—Ç–µ–ª–µ–π –≤ —Å–æ–≥–Ω—É—Ç—ã—Ö —Ä—É–∫–∞—Ö">–í—Ä–∞—â–µ–Ω–∏—è –≥–∞–Ω—Ç–µ–ª–µ–π –≤ —Å–æ–≥–Ω—É—Ç—ã—Ö —Ä—É–∫–∞—Ö</option>
                        <option value="–í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–∞—è —Ç—è–≥–∞ —Å–∏–¥—è">–í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–∞—è —Ç—è–≥–∞ —Å–∏–¥—è</option>
                        <option value="–ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–∞—è —Ç—è–≥–∞">–ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–∞—è —Ç—è–≥–∞</option>
                        <option value="–≠–∫—Å—Ç–µ–Ω–∑–∏—è">–≠–∫—Å—Ç–µ–Ω–∑–∏—è</option>
                        <option value="–°–≥–∏–±–∞–Ω–∏—è –≤ –ø—Ä–µ–¥–ø–ª–µ—á—å—è—Ö">–°–≥–∏–±–∞–Ω–∏—è –≤ –ø—Ä–µ–¥–ø–ª–µ—á—å—è—Ö</option>
                        <option value="–†–∞–±–æ—Ç–∞ —Å –≥–∏—Ä–µ–π –Ω–∞ –ø—Ä–µ–¥–ø–ª–µ—á—å—è">–†–∞–±–æ—Ç–∞ —Å –≥–∏—Ä–µ–π –Ω–∞ –ø—Ä–µ–¥–ø–ª–µ—á—å—è</option>
                    </select>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="current-weight">–¢–µ–∫—É—â–∏–π –≤–µ—Å (–∫–≥):</label>
                        <input type="number" id="current-weight" name="current_weight" step="0.5" required>
                    </div>
                    <div class="form-group">
                        <label for="target-weight">–¶–µ–ª–µ–≤–æ–π –≤–µ—Å (–∫–≥):</label>
                        <input type="number" id="target-weight" name="target_weight" step="0.5" required>
                    </div>
                </div>

                <div class="form-group">
                    <label for="frequency">–¢—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ –≤ –Ω–µ–¥–µ–ª—é:</label>
                    <select id="frequency" name="frequency">
                        <option value="1">1 —Ä–∞–∑</option>
                        <option value="2" selected>2 —Ä–∞–∑–∞</option>
                        <option value="3">3 —Ä–∞–∑–∞</option>
                        <option value="4">4+ —Ä–∞–∑</option>
                    </select>
                </div>

                <button type="submit" class="btn-primary">–†–∞—Å—Å—á–∏—Ç–∞—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å–∏—é</button>
            </form>

            <div id="progression-result" class="result-container" style="display: none;">
                <h4>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞—Å—á–µ—Ç–∞:</h4>
                <div class="result-item">
                    <strong>–û—Ü–µ–Ω–∫–∞ –≤—Ä–µ–º–µ–Ω–∏:</strong> 
                    <span id="estimated-time"></span>
                </div>
                <div class="result-item">
                    <strong>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:</strong> 
                    <span id="recommendations"></span>
                </div>
                <div id="progression-chart-container">
                    <canvas id="progressionChart"></canvas>
                </div>
            </div>
        </div>

        <!-- –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –∫–∞–ª–æ—Ä–∏–π -->
        <div class="advice-card">
            <h3>üî• –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –∫–∞–ª–æ—Ä–∏–π</h3>
            <p>–†–∞—Å—Å—á–∏—Ç–∞–π—Ç–µ —Ä–∞—Å—Ö–æ–¥ –∫–∞–ª–æ—Ä–∏–π –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è</p>
            
            <form id="calories-form" class="calculator-form">
                <div class="form-group">
                    <label for="calories-exercise">–£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ:</label>
                    <select id="calories-exercise" name="exercise_type" required>
                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ</option>
                        <option value="–ñ–∏–º –ª–µ–∂–∞">–ñ–∏–º –ª–µ–∂–∞</option>
                        <option value="–°–≤–µ–¥–µ–Ω–∏–µ —Ä—É–∫ –≤ –∫—Ä–æ—Å—Å–æ–≤–µ—Ä–µ –Ω–∞ –≥—Ä—É–¥—å">–°–≤–µ–¥–µ–Ω–∏–µ —Ä—É–∫ –≤ –∫—Ä–æ—Å—Å–æ–≤–µ—Ä–µ –Ω–∞ –≥—Ä—É–¥—å</option>
                        <option value="–†–∞–∑–≥–∏–±–∞–Ω–∏—è –Ω–∞ —Ç—Ä–∏—Ü–µ–ø—Å —Å –∫–∞–Ω–∞—Ç–Ω–æ–π —Ä—É–∫–æ—è—Ç—å—é –≤ –∫—Ä–æ—Å—Å–æ–≤–µ—Ä–µ">–†–∞–∑–≥–∏–±–∞–Ω–∏—è –Ω–∞ —Ç—Ä–∏—Ü–µ–ø—Å —Å –∫–∞–Ω–∞—Ç–Ω–æ–π —Ä—É–∫–æ—è—Ç—å—é –≤ –∫—Ä–æ—Å—Å–æ–≤–µ—Ä–µ</option>
                        <option value="–°–≥–∏–±–∞–Ω–∏—è –Ω–∞ –±–∏—Ü–µ–ø—Å –≤ –†–¢">–°–≥–∏–±–∞–Ω–∏—è –Ω–∞ –±–∏—Ü–µ–ø—Å –≤ –†–¢</option>
                        <option value="–ü–æ–¥—ä–µ–º –Ω–∞ –±–∏—Ü–µ–ø—Å —à—Ç–∞–Ω–≥–∏ –æ–±—Ä–∞—Ç–Ω—ã–º —Ö–≤–∞—Ç–æ–º">–ü–æ–¥—ä–µ–º –Ω–∞ –±–∏—Ü–µ–ø—Å —à—Ç–∞–Ω–≥–∏ –æ–±—Ä–∞—Ç–Ω—ã–º —Ö–≤–∞—Ç–æ–º</option>
                        <option value="–Ø–≥–æ–¥–∏—á–Ω—ã–π –º–æ—Å—Ç –≤ –†–¢">–Ø–≥–æ–¥–∏—á–Ω—ã–π –º–æ—Å—Ç –≤ –†–¢</option>
                        <option value="–†–∞–∑–≥–∏–±–∞–Ω–∏–µ –≥–æ–ª–µ–Ω–∏ –≤ –ë–¢">–†–∞–∑–≥–∏–±–∞–Ω–∏–µ –≥–æ–ª–µ–Ω–∏ –≤ –ë–¢</option>
                        <option value="–°–≥–∏–±–∞–Ω–∏–µ –≥–æ–ª–µ–Ω–∏ –≤ –ë–¢">–°–≥–∏–±–∞–Ω–∏–µ –≥–æ–ª–µ–Ω–∏ –≤ –ë–¢</option>
                        <option value="–ò–∫—Ä–æ–Ω–æ–∂–Ω—ã–µ –≤ –¢">–ò–∫—Ä–æ–Ω–æ–∂–Ω—ã–µ –≤ –¢</option>
                        <option value="–í—Ä–∞—â–µ–Ω–∏—è –≥–∞–Ω—Ç–µ–ª–µ–π –≤ —Å–æ–≥–Ω—É—Ç—ã—Ö —Ä—É–∫–∞—Ö">–í—Ä–∞—â–µ–Ω–∏—è –≥–∞–Ω—Ç–µ–ª–µ–π –≤ —Å–æ–≥–Ω—É—Ç—ã—Ö —Ä—É–∫–∞—Ö</option>
                        <option value="–í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–∞—è —Ç—è–≥–∞ —Å–∏–¥—è">–í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–∞—è —Ç—è–≥–∞ —Å–∏–¥—è</option>
                        <option value="–ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–∞—è —Ç—è–≥–∞">–ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–∞—è —Ç—è–≥–∞</option>
                        <option value="–≠–∫—Å—Ç–µ–Ω–∑–∏—è">–≠–∫—Å—Ç–µ–Ω–∑–∏—è</option>
                        <option value="–°–≥–∏–±–∞–Ω–∏—è –≤ –ø—Ä–µ–¥–ø–ª–µ—á—å—è—Ö">–°–≥–∏–±–∞–Ω–∏—è –≤ –ø—Ä–µ–¥–ø–ª–µ—á—å—è—Ö</option>
                        <option value="–†–∞–±–æ—Ç–∞ —Å –≥–∏—Ä–µ–π –Ω–∞ –ø—Ä–µ–¥–ø–ª–µ—á—å—è">–†–∞–±–æ—Ç–∞ —Å –≥–∏—Ä–µ–π –Ω–∞ –ø—Ä–µ–¥–ø–ª–µ—á—å—è</option>
                    </select>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="duration">–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (–º–∏–Ω—É—Ç):</label>
                        <input type="number" id="duration" name="duration" value="60" required>
                    </div>
                    <div class="form-group">
                        <label for="user-weight">–í–∞—à –≤–µ—Å (–∫–≥):</label>
                        <input type="number" id="user-weight" name="user_weight" value="70" step="0.5" required>
                    </div>
                </div>

                <button type="submit" class="btn-primary">–†–∞—Å—Å—á–∏—Ç–∞—Ç—å –∫–∞–ª–æ—Ä–∏–∏</button>
            </form>

            <div id="calories-result" class="result-container" style="display: none;">
                <h4>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞—Å—á–µ—Ç–∞:</h4>
                <div class="result-item">
                    <strong>–°–æ–∂–∂–µ–Ω–æ –∫–∞–ª–æ—Ä–∏–π:</strong> 
                    <span id="calories-burned"></span>
                </div>
                <div class="result-item">
                    <strong>MET –∑–Ω–∞—á–µ–Ω–∏–µ:</strong> 
                    <span id="met-value"></span>
                </div>
                <div class="result-item">
                    <strong>–≠–∫–≤–∏–≤–∞–ª–µ–Ω—Ç:</strong> 
                    <span id="calories-equivalent"></span>
                </div>
            </div>
        </div>

        <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –ø–µ—Ä–∏–æ–¥–∞–º -->
        <div class="advice-card">
            <h3>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –ø–µ—Ä–∏–æ–¥–∞–º</h3>
            <p>–ê–Ω–∞–ª–∏–∑ –≤–∞—à–∏—Ö —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ –∑–∞ —Ä–∞–∑–Ω—ã–µ –ø–µ—Ä–∏–æ–¥—ã –≤—Ä–µ–º–µ–Ω–∏</p>
            
            <div class="period-selector">
                <button class="period-btn active" data-period="week">–ù–µ–¥–µ–ª—è</button>
                <button class="period-btn" data-period="month">–ú–µ—Å—è—Ü</button>
                <button class="period-btn" data-period="3months">3 –º–µ—Å—è—Ü–∞</button>
            </div>

            <div id="period-stats" class="stats-container">
                <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏...</div>
            </div>
        </div>

        <!-- –î–∞—à–±–æ—Ä–¥—ã -->
        <div class="advice-card">
            <h3>üìà –î–∞—à–±–æ—Ä–¥—ã</h3>
            <p>–†–∞–∑–ª–∏—á–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –≤–∞—à–µ–≥–æ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞</p>
            
            <div class="dashboard-selector">
                <select id="dashboard-select" class="dashboard-select">
                    <option value="progress">–ü—Ä–æ–≥—Ä–µ—Å—Å –ø–æ –≤–µ—Å—É</option>
                    <option value="volume">–û–±—ä–µ–º —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫</option>
                    <option value="frequency">–ß–∞—Å—Ç–æ—Ç–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫</option>
                    <option value="distribution">–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è–º</option>
                </select>
            </div>

            <div id="dashboard-container" class="dashboard-container">
                <canvas id="dashboardChart"></canvas>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    let progressionChart = null;
    let dashboardChart = null;

    // –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –ø—Ä–æ–≥—Ä–µ—Å—Å–∏–∏
    document.getElementById('progression-form').addEventListener('submit', function(e) {
        e.preventDefault();
        
        const formData = new FormData(this);
        const data = {
            exercise_type: formData.get('exercise_type'),
            current_weight: parseFloat(formData.get('current_weight')),
            target_weight: parseFloat(formData.get('target_weight')),
            frequency: parseInt(formData.get('frequency'))
        };

        fetch('/api/calculate-progression', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(data)
        })
        .then(response => response.json())
        .then(result => {
            displayProgressionResult(result);
        });
    });

    function displayProgressionResult(result) {
        const resultDiv = document.getElementById('progression-result');
        const estimatedTime = document.getElementById('estimated-time');
        const recommendations = document.getElementById('recommendations');

        estimatedTime.textContent = `${result.estimated_weeks} –Ω–µ–¥–µ–ª—å (${result.estimated_months} –º–µ—Å—è—Ü–µ–≤)`;
        
        let recText = '';
        if (result.estimated_weeks <= 12) {
            recText = '–û—Ç–ª–∏—á–Ω—ã–π —Ç–µ–º–ø! –ü—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ –≤ —Ç–æ–º –∂–µ –¥—É—Ö–µ.';
        } else if (result.estimated_weeks <= 24) {
            recText = '–°—Ç–∞–±–∏–ª—å–Ω—ã–π –ø—Ä–æ–≥—Ä–µ—Å—Å. –£–≤–µ–ª–∏—á—å—Ç–µ —á–∞—Å—Ç–æ—Ç—É —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è.';
        } else {
            recText = '–î–æ–ª–≥–æ—Å—Ä–æ—á–Ω–∞—è —Ü–µ–ª—å. –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è —Ç—Ä–µ–Ω–µ—Ä–∞ –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–≥—Ä–∞–º–º—ã.';
        }
        
        recommendations.textContent = recText;
        resultDiv.style.display = 'block';

        // –°—Ç—Ä–æ–∏–º –≥—Ä–∞—Ñ–∏–∫ –ø—Ä–æ–≥—Ä–µ—Å—Å–∏–∏
        buildProgressionChart(result);
    }

    function buildProgressionChart(result) {
        const ctx = document.getElementById('progressionChart').getContext('2d');
        
        // –£–Ω–∏—á—Ç–æ–∂–∞–µ–º —Å—Ç–∞—Ä—ã–π –≥—Ä–∞—Ñ–∏–∫ –µ—Å–ª–∏ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
        if (progressionChart) {
            progressionChart.destroy();
        }
        
        const labels = result.progression_data.map(item => `–ù–µ–¥–µ–ª—è ${item.week}`);
        const weights = result.progression_data.map(item => item.weight);

        progressionChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: labels,
                datasets: [{
                    label: `–ü—Ä–æ–≥—Ä–µ—Å—Å –≤ ${result.exercise}`,
                    data: weights,
                    borderColor: '#333',
                    tension: 0.1,
                    fill: false
                }]
            },
            options: {
                responsive: true,
                scales: {
                    y: {
                        beginAtZero: false,
                        title: {
                            display: true,
                            text: '–í–µ—Å (–∫–≥)'
                        }
                    },
                    x: {
                        title: {
                            display: true,
                            text: '–ù–µ–¥–µ–ª–∏'
                        }
                    }
                }
            }
        });
    }

    // –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –∫–∞–ª–æ—Ä–∏–π
    document.getElementById('calories-form').addEventListener('submit', function(e) {
        e.preventDefault();
        
        const formData = new FormData(this);
        const data = {
            exercise_type: formData.get('exercise_type'),
            duration: parseInt(formData.get('duration')),
            user_weight: parseFloat(formData.get('user_weight'))
        };

        fetch('/api/calculate-calories', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(data)
        })
        .then(response => response.json())
        .then(result => {
            displayCaloriesResult(result);
        });
    });

    function displayCaloriesResult(result) {
        const resultDiv = document.getElementById('calories-result');
        const caloriesBurned = document.getElementById('calories-burned');
        const metValue = document.getElementById('met-value');
        const equivalent = document.getElementById('calories-equivalent');

        caloriesBurned.textContent = `${result.calories_burned} –∫–∫–∞–ª`;
        metValue.textContent = result.met_value;
        
        // –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –æ–±—ã—á–Ω—ã–º–∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—è–º–∏
        let equivText = '';
        if (result.calories_burned < 100) {
            equivText = '–ü—Ä–∏–º–µ—Ä–Ω–æ –∫–∞–∫ 15 –º–∏–Ω—É—Ç —Ö–æ–¥—å–±—ã';
        } else if (result.calories_burned < 200) {
            equivText = '–ü—Ä–∏–º–µ—Ä–Ω–æ –∫–∞–∫ 30 –º–∏–Ω—É—Ç —É–±–æ—Ä–∫–∏';
        } else {
            equivText = '–ü—Ä–∏–º–µ—Ä–Ω–æ –∫–∞–∫ 45 –º–∏–Ω—É—Ç –ø–ª–∞–≤–∞–Ω–∏—è';
        }
        
        equivalent.textContent = equivText;
        resultDiv.style.display = 'block';
    }

    // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –ø–µ—Ä–∏–æ–¥–∞–º
    document.querySelectorAll('.period-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            document.querySelectorAll('.period-btn').forEach(b => b.classList.remove('active'));
            this.classList.add('active');
            
            loadPeriodStats(this.dataset.period);
        });
    });

    function loadPeriodStats(period) {
        const statsContainer = document.getElementById('period-stats');
        statsContainer.innerHTML = '<div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏...</div>';

        fetch(`/api/workout-stats/${period}`)
            .then(response => response.json())
            .then(stats => {
                displayPeriodStats(stats);
            });
    }

    function displayPeriodStats(stats) {
        const statsContainer = document.getElementById('period-stats');
        
        let html = `
            <div class="period-header">
                <h4>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞ ${stats.period === 'week' ? '–Ω–µ–¥–µ–ª—é' : stats.period === 'month' ? '–º–µ—Å—è—Ü' : '3 –º–µ—Å—è—Ü–∞'}</h4>
                <p>–í—Å–µ–≥–æ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫: <strong>${stats.total_workouts}</strong></p>
            </div>
        `;

        if (Object.keys(stats.exercise_stats).length > 0) {
            html += '<div class="exercise-stats">';
            for (const [exercise, data] of Object.entries(stats.exercise_stats)) {
                html += `
                    <div class="exercise-stat-item">
                        <div class="exercise-name">${exercise}</div>
                        <div class="exercise-data">
                            <span>–¢—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫: ${data.count}</span>
                            <span>–ú–∞–∫—Å. –≤–µ—Å: ${data.max_weight}–∫–≥</span>
                            <span>–û–±—ä–µ–º: ${Math.round(data.total_volume)}–∫–≥</span>
                        </div>
                    </div>
                `;
            }
            html += '</div>';
        } else {
            html += '<p class="no-data">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥</p>';
        }

        statsContainer.innerHTML = html;
    }

    // –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∞—á–∞–ª—å–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
    loadPeriodStats('week');

    // –î–∞—à–±–æ—Ä–¥—ã
    document.getElementById('dashboard-select').addEventListener('change', function() {
        loadDashboard(this.value);
    });

    function loadDashboard(type) {
        const ctx = document.getElementById('dashboardChart').getContext('2d');
        
        // –£–Ω–∏—á—Ç–æ–∂–∞–µ–º —Å—Ç–∞—Ä—ã–π –≥—Ä–∞—Ñ–∏–∫ –µ—Å–ª–∏ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
        if (dashboardChart) {
            dashboardChart.destroy();
        }
        
        // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –¥–∞—à–±–æ—Ä–¥–æ–≤
        fetch('/api/progress-data')
            .then(response => response.json())
            .then(data => {
                buildDashboardChart(type, data, ctx);
            });
    }

    function buildDashboardChart(type, data, ctx) {
        let chartConfig = {};
        
        switch(type) {
            case 'progress':
                // –ì—Ä–∞—Ñ–∏–∫ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –ø–æ –≤–µ—Å—É
                const datasets = [];
                const colors = ['#333', '#666', '#999', '#ccc'];
                
                let i = 0;
                for (const [exercise, exerciseData] of Object.entries(data)) {
                    datasets.push({
                        label: exercise,
                        data: exerciseData.weights,
                        borderColor: colors[i % colors.length],
                        tension: 0.1,
                        fill: false
                    });
                    i++;
                }
                
                chartConfig = {
                    type: 'line',
                    data: {
                        labels: datasets.length > 0 ? data[Object.keys(data)[0]].dates : [],
                        datasets: datasets
                    },
                    options: {
                        responsive: true,
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: '–í–µ—Å (–∫–≥)'
                                }
                            }
                        }
                    }
                };
                break;
                
            case 'volume':
                // –ì—Ä–∞—Ñ–∏–∫ –æ–±—ä–µ–º–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫
                const volumeData = [];
                const volumeLabels = [];
                
                for (const [exercise, exerciseData] of Object.entries(data)) {
                    if (exerciseData.weights.length > 0) {
                        volumeLabels.push(exercise);
                        const lastWeight = exerciseData.weights[exerciseData.weights.length - 1];
                        volumeData.push(lastWeight);
                    }
                }
                
                chartConfig = {
                    type: 'bar',
                    data: {
                        labels: volumeLabels,
                        datasets: [{
                            label: '–¢–µ–∫—É—â–∏–π –≤–µ—Å',
                            data: volumeData,
                            backgroundColor: '#333'
                        }]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: '–í–µ—Å (–∫–≥)'
                                }
                            }
                        }
                    }
                };
                break;
                
            default:
                chartConfig = {
                    type: 'bar',
                    data: {
                        labels: ['–ü–Ω', '–í—Ç', '–°—Ä', '–ß—Ç', '–ü—Ç', '–°–±', '–í—Å'],
                        datasets: [{
                            label: '–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å',
                            data: [12, 19, 3, 5, 2, 3, 15],
                            backgroundColor: '#333'
                        }]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                };
        }
        
        dashboardChart = new Chart(ctx, chartConfig);
    }

    // –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∞—á–∞–ª—å–Ω–æ–≥–æ –¥–∞—à–±–æ—Ä–¥–∞
    loadDashboard('progress');
</script>
{% endblock %}